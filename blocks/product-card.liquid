{% doc %}
  Renders a product-card block.
  Uses placeholder content for now
{% enddoc %}

{% assign product = block.settings.product %}

{% assign active_variant = product.selected_or_first_available_variant %}

<div class="product" data-product-handle="{{ product.handle }}">
  <script type="application/json" data-variants>
    [
      {% for variant in product.variants %}
        {
          "id": {{ variant.id }},
          "price": {{ variant.price }},
          "compare_at_price": {{ variant.compare_at_price }},
          "featured_image": {{ variant.featured_image | json }},
          "metafields": {
            "custom": {
              "image_hover": "{{ variant.metafields.custom.image_hover | image_url }}"
            }
          }
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  </script>

  <div class="top">
    <div class="image">
      <img
        src="{{
          active_variant.featured_image
          | default: product.featured_image
          | image_url: width: 800
        }}"
        alt="Plain T-Shirt default view"
        class="product-image default"
        width="300"
        height="300"
      >
      <img
        src="{{
          active_variant.metafields.custom.image_hover
          | default: product.featured_image
          | image_url: width: 800
        }}"
        alt="Plain T-Shirt hover view"
        class="product-image hover"
        width="300"
        height="300"
      >
    </div>
    {% if active_variant.compare_at_price > active_variant.price %}
      <div class="badge-sale">
        <p>On Sale!</p>
      </div>
    {% else %}
      <div class="badge-sale hidden">
        <p>On Sale!</p>
      </div>
    {% endif %}
  </div>
  <div class="bottom">
    {% if product.variants.size > 1 %}
      <div class="variant-swatches swatch-{{ section.settings.variant_swatch_shape }}">
        {% for variant in product.variants %}
          {% assign id = variant.id %}
          {% assign title = variant.title %}
          {% assign swatch_hex = variant.metafields.custom.swatch_hex %}

          <label
            class="variant-swatch swatch-{{ title | handle }}"
            style="--swatch-color: {{ swatch_hex }};">
            <input
              type="radio"
              name="radio-{{ block.id }}"
              value="{{ variant.id }}"
              class="variant-swatch-input"
              {% if forloop.first %}checked{% endif %}
            >
            <span class="variant-swatch-title">{{ title }}</span>
          </label>
        {% endfor %}
      </div>
    {% endif %}
    <div class="info">
      <h3 class="product-brand">{{ product.metafields.custom.brand }}</h3>
      <h3 class="product-name">{{ product.title }}</h3>
      <div class="price">
        {% if active_variant.compare_at_price > active_variant.price %}
          <span class="price-original discounted">{{ active_variant.compare_at_price | money }}</span>
          <span class="price-discounted">{{ active_variant.price | money }}</span>
          {% if section.settings.show_discount_percentage %}
            {% assign savings = active_variant.compare_at_price | minus: active_variant.price %}
            {% assign discount_percentage = savings | times: 100 | divided_by: active_variant.compare_at_price %}
            <span class="price-discounted-percentage">{{ discount_percentage }}% off</span>
          {% else %}
            <span class="price-discounted-percentage"></span>
          {% endif %}
        {% else %}
          <span class="price-original">{{ active_variant.compare_at_price | money }}</span>
          <span class="price-discounted"></span>
          <span class="price-discounted-percentage"></span>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% stylesheet %}
  .product {
    padding: 27px;
    background-color: white;
    display: flex;
    flex-direction: column;
    gap: 15px;
    height: 100%;

    .top {
      position: relative;
      border: solid 1px #E8E8E8;
      border-radius: 20px;
      overflow: hidden;

      .image {
        position: relative;
        display: inline-block;

        .product-image {
          display: block;
          width: 100%;
          height: auto;

          &.hover {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
          }
        }

        &:hover {
          .product-image {
            &.hover {
              opacity: 1;
            }

            &.default {
              opacity: 0;
            }
          }
        }
      }

      .badge-sale {
        color: red;
        font-weight: 600;
        font-size: 16px;
        background-color: white;
        border: solid 1px red;
        border-radius: 16px;
        padding: 6.4px 12.8px;
        position: absolute;
        top: 20px;
        left: 20px;

        &.hidden {
          display: none;
        }
      }
    }

    .bottom {
      display: flex;
      flex-direction: column;
      gap: 15px;

      .variant-swatches {
        display: flex;
        gap: 8px;

        .variant-swatch {
          display: inline-block;
          width: 20px;
          height: 20px;
          background-color: var(--swatch-color);
          cursor: pointer;
          position: relative;
        }

        /* Hide default radio input and label */
        .variant-swatch-input,
        .variant-swatch-title {
          opacity: 0;
          position: absolute;
          inset: 0;
          cursor: pointer;
        }

        /* Selected state */
        .variant-swatch-input:checked + .variant-swatch,
        .variant-swatch:has(input:checked) {
          outline: 1px solid #0A4874;
          outline-offset: 2px;
        }

        &.swatch-circle .variant-swatch {
          border-radius: 50%;
        }

        &.swatch-square .variant-swatch {
          border-radius: 10%;
        }
      }

      .info { 
        display: flex;
        flex-direction: column;
        gap: 6px;

        .product-brand {
          font-weight: 400;
          font-size: 14px;
        }

        .product-name {
          color: #0A4874;
          font-size: 16px;
          font-weight: 600;
        }

        .price {
          display: flex;
          flex-direction: row;
          gap: 8px;
          font-size: 14px;

          .price-original {
            color: #111111;
            
            &.discounted { 
              text-decoration: line-through;
            }
          }

          .price-discounted {
            color: red;
          }

          .price-discounted-percentage {
            color: red;
          }
        }
      }
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Product Card",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Select product"
    }
  ],
  "presets": [
    { "name": "Product Card" }
  ]
}
{% endschema %}