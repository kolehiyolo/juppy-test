{% doc %}
  Renders a product-card block.
  Uses placeholder content for now
{% enddoc %}

{% assign product = block.settings.product %}

{% assign active_variant = product.selected_or_first_available_variant %}

<div class="product">
  <div class="top">
    <div class="image">
      <img
        src="{{
          active_variant.featured_image
          | default: product.featured_image
          | image_url: width: 800
        }}"
        alt="Plain T-Shirt default view"
        class="product-image default"
        width="300"
        height="300"
      >
      <img
        src="{{
          active_variant.metafields.custom.image_hover
          | default: product.featured_image
          | image_url: width: 800
        }}"
        alt="Plain T-Shirt hover view"
        class="product-image hover"
        width="300"
        height="300"
      >
    </div>
    <div class="badge-sale">
      <p>On Sale!</p>
    </div>
  </div>
  <div class="bottom">
    <div class="variant-swatches">
      {% for variant in product.variants %}
        {% assign id = variant.id %}
        {% assign title = variant.title %}
        {% assign swatch_hex = variant.metafields.custom.swatch_hex %}

        <label
          class="variant-swatch swatch-{{ title | handle }}"
          style="--swatch-color: {{ swatch_hex }};">
          <input
            type="radio"
            name="radio-{{ block.id }}"
            value="{{ title | handle }}"
            class="variant-swatch-input"
            {% if forloop.first %}checked{% endif %}
          >
          <span class="variant-swatch-title">{{ title }}</span>
        </label>
      {% endfor %}
    </div>
    <div class="info">
      <h3 class="product-brand">{{ product.metafields.custom.brand }}</h3>
      <h3 class="product-name">{{ product.title }}</h3>
      <div class="price">
        <span class="original">{{ active_variant.compare_at_price | money }}</span>
        <span class="discounted">{{ active_variant.price | money }}</span>
      </div>
    </div>
  </div>
</div>

{% stylesheet %}
  .product {
    padding: 27px;
    background-color: white;
    display: flex;
    flex-direction: column;
    gap: 15px;

    .top {
      position: relative;
      border: solid 1px #E8E8E8;
      border-radius: 20px;
      overflow: hidden;

      .image {
        position: relative;
        display: inline-block;

        .product-image {
          display: block;
          width: 100%;
          height: auto;

          &.hover {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
          }
        }

        &:hover {
          .product-image {
            &.hover {
              opacity: 1;
            }

            &.default {
              opacity: 0;
            }
          }
        }
      }

      .badge-sale {
        color: red;
        font-weight: 600;
        font-size: 16px;
        background-color: white;
        border: solid 1px red;
        border-radius: 16px;
        padding: 6.4px 12.8px;
        position: absolute;
        top: 20px;
        left: 20px;
      }
    }

    .bottom {
      display: flex;
      flex-direction: column;
      gap: 15px;

      .variant-swatches {
        display: flex;
        gap: 8px;

        .variant-swatch {
          display: inline-block;
          width: 20px;
          height: 20px;
          background-color: var(--swatch-color);
          border-radius: 50%;
          cursor: pointer;
          position: relative;
        }

        /* Hide default radio input and label */
        .variant-swatch-input,
        .variant-swatch-title {
          opacity: 0;
          position: absolute;
          inset: 0;
          cursor: pointer;
        }

        /* Selected state */
        .variant-swatch-input:checked + .variant-swatch,
        .variant-swatch:has(input:checked) {
          outline: 1px solid #0A4874;
          outline-offset: 2px;
        }
      }

      .info { 
        display: flex;
        flex-direction: column;
        gap: 6px;

        .product-brand {
          font-weight: 400;
          font-size: 14px;
        }

        .product-name {
          color: #0A4874;
          font-size: 16px;
          font-weight: 600;
        }

        .price {
          display: flex;
          flex-direction: row;
          gap: 8px;
          font-size: 14px;

          .original {
            text-decoration: line-through;
            color: #111111;
          }

          .discounted {
            color: red;
          }
        }
      }
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Product Card",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Select product"
    }
  ],
  "presets": [
    { "name": "Product Card" }
  ]
}
{% endschema %}