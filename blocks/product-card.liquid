{% doc %}
  Renders a product-card block.
{% enddoc %}

{% assign product = block.settings.product %}

{% assign active_variant = product.selected_or_first_available_variant %}

<div class="product p-[27px] bg-white flex flex-col gap-[15px] h-full" data-product-handle="{{ product.handle }}">
  <script type="application/json" data-variants>
    [
      {% for variant in product.variants %}
        {
          "id": {{ variant.id }},
          "price": {{ variant.price }},
          "compare_at_price": {{ variant.compare_at_price }},
          "featured_image": {{ variant.featured_image | json }},
          "metafields": {
            "custom": {
              "image_hover": "{{ variant.metafields.custom.image_hover | image_url }}"
            }
          }
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  </script>
  <div class="top relative border border-[#E8E8E8] rounded-[20px] overflow-hidden">
    <div class="image relative inline-block group">
      <img
        src="{{
          active_variant.featured_image
          | default: product.featured_image
          | image_url: width: 600
        }}"
        srcset="
          {{
            active_variant.featured_image
            | default: product.featured_image
            | image_url: width: 300
          }} 300w,
          {{
            active_variant.featured_image
            | default: product.featured_image
            | image_url: width: 600
          }} 600w,
          {{
            active_variant.featured_image
            | default: product.featured_image
            | image_url: width: 800
          }} 800w
        "
        sizes="(max-width: 640px) 100vw, 300px"
        alt="{{ product.title | escape }} (default)"
        class="product-image-default block w-full h-auto opacity-100 transition-opacity duration-300 ease-in-out group-hover:opacity-0"
        width="300"
        height="300"
        loading="lazy"
        decoding="async"
      >
      <img
        src="{{
          active_variant.metafields.custom.image_hover
          | default: product.featured_image
          | image_url: width: 800
        }}"
        srcset="
          {{
            active_variant.metafields.custom.image_hover
            | default: product.featured_image
            | image_url: width: 300
          }} 300w,
          {{
            active_variant.metafields.custom.image_hover
            | default: product.featured_image
            | image_url: width: 600
          }} 600w,
          {{
            active_variant.metafields.custom.image_hover
            | default: product.featured_image
            | image_url: width: 800
          }} 800w
        "
        sizes="(max-width: 640px) 100vw, 300px"
        alt="{{ product.title | escape }} (hover)"
        class="product-image-hover absolute top-0 left-0 block w-full h-auto opacity-0 transition-opacity duration-300 ease-in-out group-hover:opacity-100"
        width="300"
        height="300"
        loading="lazy"
        decoding="async"
      >
    </div>
    <div class="badge-sale absolute top-5 left-5 text-red-600 font-semibold text-base bg-white border border-red-600 rounded-full px-3 py-1.5 
      {% unless active_variant.compare_at_price > active_variant.price %}
        hidden
      {% endunless %}
    ">
      <p>On Sale!</p>
    </div>
  </div>
  <div class="bottom flex flex-col gap-[15px] grow">
    {% if product.variants.size > 1 %}
      <div class="variant-swatches flex gap-2">
        {% for variant in product.variants %}
          {% assign id = variant.id %}
          {% assign title = variant.title %}
          {% assign swatch_hex = variant.metafields.custom.swatch_hex %}

          <label
            class="variant-swatch swatch-{{ title | handle }} relative"
          >
            <input
              type="radio"
              name="radio-{{ block.id }}"
              value="{{ variant.id }}"
              class="variant-swatch-input peer absolute inset-0 opacity-0 cursor-pointer"
              {% if forloop.first %}checked{% endif %}
            >
            <span
              class="block w-5 h-5 cursor-pointer
                {% if section.settings.variant_swatch_shape == 'circle' %}rounded-full{% endif %}
                {% if section.settings.variant_swatch_shape == 'square' %}rounded-md{% endif %}
              "
              style="background-color: {{ swatch_hex }};">
            </span>
            <span class="variant-swatch-title sr-only">{{ title }}</span>
            <span
              class="pointer-events-none absolute inset-[-4px] border border-transparent peer-checked:border-[#0A4874] peer-checked:border-1
                {% if section.settings.variant_swatch_shape == 'circle' %}rounded-full{% endif %}
                {% if section.settings.variant_swatch_shape == 'square' %}rounded-md{% endif %}
              ">
            </span>
          </label>
        {% endfor %}
      </div>
    {% endif %}
    <div class="info flex flex-col gap-[6px] grow">
      <p class="product-brand text-sm font-normal">
        {{ product.metafields.custom.brand }}
      </p>
      <h3 class="product-name text-base font-semibold text-[#0A4874]">
        {{ product.title }}
      </h3>
      <div class="price flex flex-row gap-2 text-sm">
        {% if active_variant.compare_at_price > active_variant.price %}
          <span class="price-original text-[#111111] line-through">{{ active_variant.compare_at_price | money }}</span>
          <span class="price-discounted text-red-600">{{ active_variant.price | money }}</span>
          {% if section.settings.show_discount_percentage %}
            {% assign savings = active_variant.compare_at_price | minus: active_variant.price %}
            {% assign discount_percentage = savings | times: 100 | divided_by: active_variant.compare_at_price %}
            <span class="price-discounted-percentage text-red-600">{{ discount_percentage }}% off</span>
          {% else %}
            <span class="price-discounted-percentage"></span>
          {% endif %}
        {% else %}
          <span class="price-original text-[#111111]">{{ active_variant.compare_at_price | money }}</span>
          <span class="price-discounted text-red-600"></span>
          <span class="price-discounted-percentage text-red-600"></span>
        {% endif %}
      </div>
    </div>
    <div class="buttons">
      <button
        class="add bg-[#0A4874] text-white px-4 py-2 rounded-md"
        data-product-id="{{ product.id }}"
      >
        Add to Cart
      </button>
    </div>
  </div>
</div>

{% stylesheet %}
  /* .bottom {
    flex-grow: 1;

    .info {
      flex-grow: 1;
    }
  } */
{% endstylesheet %}

{% schema %}
{
  "name": "Product Card",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Select product"
    }
  ],
  "presets": [
    { "name": "Product Card" }
  ]
}
{% endschema %}